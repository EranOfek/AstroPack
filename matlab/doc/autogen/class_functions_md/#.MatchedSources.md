# Class: MatchedSources



    
    MatchedSources class - A container for matrices of matched sources  
    Properties:  
    Data  - A structure, in which each field is a matrix of identical sizes  
    containing Nepoch X Nsrc measurments of some property.  
    JD     - A vector of times per epoch. If not set by user default is a  
    vector of 1..Nepoch.  
    Fields - A cell array of field names (Dependent)  
    Nsrc   - Number of sources in each matrix.  
    Nepoch - Number of epochs in each matrix.  
    DimEpoch - Dim of epoch (constant) = 1  
    DimSrc   - Dim of sources (constant) = 2  
    Methods:  
    read (static) - Read a mat/hdf5 into MatchedSources  
    write - Write a MatchedSources into mat/hdf5 file.  
    addMatrix - Add matrix/struct/matched AstroTable into the MatchedSources Data.  
    getMatrix - Get matrix using field name.  
    summary   - Summary of a specific field matrix in MatchedSources.  
    plotRMS   - plot rms of mag vs. mag  
      
      
      

### Functions List

    addMatrix - Add matrix/struct/matched AstroTable into the MatchedSources Data Obj = addMatrix(Obj, Matrix, FieldName)
    deleteMatrix - remove matrix and field name from an MatchedSources object
    designMatrix - Generate a general purpose design matrix from an MatchedSources object Description: Construct a design matrix of the form: H = [FunCell{1}(Col1), FunCell{2}(Col2), ...] where the FunCell are user provided functionals, and Col are the MatchedSources matrix of a
    designMatrixCalib - Generate the design matrix for relative photometric calibration Reference: Ofek+2011
    get.Fields - getter for Fields
    get.JD - getter for JD (return 1..Nepoch) if doesnt exist
    get.Nepoch - getter for Nepoch
    get.Nsrc - getter for Nsrc
    getFieldNameDic - Get field name in MatchedSources Data properties that first appear in a dictionary (cell array).
    getLC_ind - get the LC [JD, Mag] of a source by its index (column number)
    getLonLat - Get data matrices containing the RA/Dec fields.
    getMatrix - Get matrix using field name
    notNanEpochs - Return a vector of logicals indicating epochs which do have any NaNs in their data.
    notNanSources - Return a vector of logicals indicating soueces which do have any NaNs in theor data.
    plotRMS - plot rms of a propery (field) vs. its mean.
    read - read mat file or HDF5 file containing MatchedSources
    statSummary - Calculate statistical summary properties of a data property in a MatchedSources object.
    summary - Summary of a specific field matrix in MatchedSources
    unitTest - unitTest for MatchedSources class
    write - Write a MatchedSources object to HDF5 or mat file

### addMatrix

Add matrix/struct/matched AstroTable into the MatchedSources Data Obj = addMatrix(Obj, Matrix, FieldName)


    
    Add matrix/struct/matched AstroTable into the MatchedSources Data  
    Obj = addMatrix(Obj, Matrix, FieldName)  
    Input  : - A single element MatchedSources object.  
    - One of the following inputs:  
    1. A numeric matrix. In this case, FieldName must  
    be a char array with field name in which to store  
    the matrix.  
    2. A cell array of matrices. In this case  
    FieldName must be a cell array of field names, per  
    matrix.  
    3. A struct. In this case the struct will be  
    copied to the Data field.  
    4. A matched AstroTable/AstroCatalog object  
    In this case, the columns will be selected from  
    FieldName.  
    - A field name (or a cell array of field names).  
    If the field already exist, then replace the  
    current content with the new content.  
    Output : - A MatchedSources object.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    MS = MatchedSources;  
    St.Flux=rand(100,200); MS.addMatrix(St);  
      
      


### deleteMatrix

remove matrix and field name from an MatchedSources object


    
    remove matrix and field name from an MatchedSources object  
    Input  : - A MatchedSources object  
    - A field name, or a cell array of field names.  
    Output : - A MatchedSources object  
    Author : Eran Ofek (Jun 2021)  
    Example: MS.deleteMatrix('X2')  
      


### designMatrix

Generate a general purpose design matrix from an MatchedSources object Description: Construct a design matrix of the form: H = [FunCell{1}(Col1), FunCell{2}(Col2), ...] where the FunCell are user provided functionals, and Col are the MatchedSources matrix of a


    
    Generate a general purpose design matrix from an MatchedSources object  
    Description: Construct a design matrix of the form:  
    H = [FunCell{1}(Col1), FunCell{2}(Col2), ...]  
    where the FunCell are user provided functionals,  
    and Col are the MatchedSources matrix of a  
    specific column name after vectorization (i.e.,  
    Matrix(:)).  
    Also constrict a Y and ErrY vectors.  
    Input  : - A single element MatchedSources object.  
    - A cell array of column names from which to  
    construct the design matrix.  
    - (FunCell) A cell array of functional to operate on each  
    corresponding column name. Each element in the  
    cell may be a function_handle, or an integer  
    representing the power to apply to the column.  
    If empty element, then the cooresponding column in  
    the design matrix will contains one (i.e., solve  
    for a constant).  
    - Column name for the Y vector.  
    - A function hanle, numeric, or empty (lie FunCell)  
    to apply to the Y column name.  
    - Column name for the ErrY vector.  
    - A function hanle, numeric, or empty (lie FunCell)  
    to apply to the ErrY column name.  
    Output : - Design matrix.  
    - Y column.  
    - ErrY column.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    St.X2=rand(100,200);  
    MS.addMatrix(St);  
    [H, Y] = MS.designMatrix({'FLUX','X','Y'},{@sin, 1, 2},'MAG',1);  
    [H, Y] = MS.designMatrix({[],'X','Y'},{[], 1, 2},'MAG',1);  
    [H, Y, ErrY] = MS.designMatrix({[],'X','Y'},{[], 1, 2},'MAG',1, 'MAG',2);  
      


### designMatrixCalib

Generate the design matrix for relative photometric calibration Reference: Ofek+2011


    
    Generate the design matrix for relative photometric calibration  
    Reference: Ofek+2011  
    Input  : - Number of epochs.  
    - Number of sources.  
    * ...,key,val,...  
    'UseSparse' - A logical indicating if to generate  
    a sparse design matrix. Default is false.  
    'SrcProp' - A cell array of additional properties  
    to add to the design matrix.  
    Each cell element can be a row vector  
    (property per source; e.g., color), a  
    column vector (property per epoch; e.g.,  
    air mass), or a matrix of size Nep X Nsrc.  
    These properties will be added to the  
    design matrix according to the scheme  
    dictated by 'SrcPropCoefType'.  
    Default is {}.  
    'SrcPropCoefType' - A vector of numbers, each  
    element corresponds to a cell element in  
    'SrcProp'. The numbres may be one of the  
    following:  
    1 - will add a single column to the design  
    matrix (i.e., a single coef.).  
    2 - will add a column per epoch.  
    Output : - The design matrix.  
    Author : Eran Ofek (Jul 2021)  
    Example: H=MatchedSources.designMatrixCalib(2,4)  
    H=MatchedSources.designMatrixCalib(2,4,'UseSparse',true)  
    H=MatchedSources.designMatrixCalib(2,4,'SrcProp',{3.*ones(1,4)})  
    H=MatchedSources.designMatrixCalib(2,4,'SrcProp',{3.*ones(1,4)},'SrcPropCoefType',2)  
      


### get.Fields

getter for Fields


    
    getter for Fields  


### get.JD

getter for JD (return 1..Nepoch) if doesnt exist


    
    getter for JD (return 1..Nepoch) if doesnt exist  


### get.Nepoch

getter for Nepoch


    
    getter for Nepoch  


### get.Nsrc

getter for Nsrc


    
    getter for Nsrc  


### getFieldNameDic

Get field name in MatchedSources Data properties that first appear in a dictionary (cell array).


    
    Get field name in MatchedSources Data properties that first  
    appear in a dictionary (cell array).  
    Input  : - A Matched Sources object.  
    - A cell array of dictionary (i.e., alternative  
    field names corresponding to a single field.  
    Output : - A string of field name.  
    Author : Eran Ofek (Sep 2021)  
    Example: Obj = MatchedSources;  
    Obj.addMatrix(rand(30,40),'RA');  
    Obj.addMatrix(rand(30,40),'Dec');  
    [FieldName] = getFieldNameDic(Obj, MatchedSources.DefNamesDec)  
      


### getLC_ind

get the LC [JD, Mag] of a source by its index (column number)


    
    get the LC [JD, Mag] of a source by its index (column number)  
    Input  : - A single-element MatchedSources object  
    - The index/s of the source in the matched matrix  
    (i.e., column number).  
    - A dictionary cell array of field names to search  
    in the MatchedSources.Data (return the first  
    exitsing field).  
    Output : - JD vector.  
    - Mag (or selected field) vector/array for the selected  
    sources.  
    Author : Eran Ofek (Jul 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    [JD, Mag] = getLC_ind(MS, [2 3], {'FLUX'})  
      


### getLonLat

Get data matrices containing the RA/Dec fields.


    
    Get data matrices containing the RA/Dec fields.  
    Input  : - A MatchedSources object.  
    Output : - A matrix of RA (longitude).  
    - A matrix of Dec (latitude).  
    - A matrix of RA errors.  
    - A matrix of Dec errors.  
    Author : Eran Ofek (Sep 2021)  
    Example: Obj = MatchedSources;  
    Obj.addMatrix(rand(30,40),'RA');  
    Obj.addMatrix(rand(30,40),'Dec');  
    [MatRA, MatDec] = getLonLat(Obj)  
      


### getMatrix

Get matrix using field name


    
    Get matrix using field name  
    Input  : - A single element MatchedSources object.  
    - Field name, or a cell array of field names.  
    Output : - A mtrix of [Epoch X Source] for each requested  
    field.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources; MS.Data.FLUX = rand(100,200);  
    A = MS.getMatrix('FLUX');  
      


### notNanEpochs

Return a vector of logicals indicating epochs which do have any NaNs in their data.


    
    Return a vector of logicals indicating epochs which do have any NaNs in their data.  
    Input  : - A single element MatchesSources object.  
    - A field name, a cell array of field names, or  
    empty. If empty, will use all field names.  
    For each field name, will flag epochs which  
    contains NaN's in their rows.  
    Defailt is empty.  
    Output : - A column vector of logicals. True for epochs that  
    non of their values in their rows contains NaN.  
    This is calculated over all requested fields, as  
    an or operation (i.e., if one of the rows in  
    one of the fields contains NaN, the epoch will be  
    flagged).  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    St.X2=rand(100,200);  
    MS.addMatrix(St);  
    MS.Data.FLUX(1,1)=NaN;  
    Flag = notNanEpochs(MS, 'FLUX');  
    Flag = notNanEpochs(MS, []);  use all fields  
      


### notNanSources

Return a vector of logicals indicating soueces which do have any NaNs in theor data.


    
    Return a vector of logicals indicating soueces which do have any NaNs in theor data.  
    Input  : - A single element MatchesSources object.  
    - A field name, a cell array of field names, or  
    empty. If empty, will use all field names.  
    For each field name, will flag sources which  
    contains NaN's in their columns.  
    Defailt is empty.  
    Output : - A row vector of logicals. True for sources that  
    non of their values in their columns contains NaN.  
    This is calculated over all requested fields, as  
    an or operation (i.e., if one of the columns in  
    one of the fields contains NaN, the star will be  
    flagged).  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    St.X2=rand(100,200);  
    MS.addMatrix(St);  
    MS.Data.FLUX(1,1)=NaN;  
    Flag = notNanSources(MS, 'FLUX');  
    Flag = notNanSources(MS, []);  use all fields  
      


### plotRMS

plot rms of a propery (field) vs. its mean.


    
    plot rms of a propery (field) vs. its mean.  
    Input  : - A single element MatchedSources object.  
    * ...,key,val,...  
    'FieldX' - A cell array of field names. Will chose  
    the first field name that appears in the  
    Data structure, and its content will be plotted.  
    Default is {'MAG','MAG_PSF','MAG_APER'}.  
    'PlotSymbol' - A cell array of parameters to pass  
    to the plot function.  
    Default is  
    {'k.','MarkerFaceColor','k','MarkerSize',3}.  
    'BinSize' - Bin size for plotting binned data  
    points. If empty, do not plot binned data.  
    Default is [].  
    'DivideErrBySqrtN' - Divide binned plot errors by  
    sqrt(N). Default is true.  
    'BinMarker' - Default is 'o'.  
    'BinColor' - Default is 'k'.  
    'BinMarkerSize' - Default is 6.  
    'XScale' - Default is 'linear'.  
    'YScale' - Default is 'log'.  
    'MeanFun' - Default is @tools.math.stat.median.  
    'StdFun' - Default is @tools.math.stat.nanstd.  
    'Xlabel' - Default is 'Mean Mag'.  
    'Ylabel' - Default is 'RMS'.  
    'FontSize' - Default is 16.  
    'Interpreter' - Default is 'latex'  
    Output : - Handle for data points plot.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'MAG_PSF');  
    MS.plotRMS  
    MS.plotRMS('BinSize',0.1)  
      


### read

read mat file or HDF5 file containing MatchedSources


    
    read mat file or HDF5 file containing MatchedSources  
    Input  : - A file name.  
    * ...,key,val,...  
    'Fields' - A field, or cell array of fields to  
    read from an HDF5 file. In the case of a  
    mat file, all fields are read.  
    'FileType' - One of the following:  
    ['auto'] - will attempt to identify file type  
    by its extension.  
    'hdf5' - An HDF5 file, in which the  
    datasets are the field names.  
    'mat' - A mat file containing a structure  
    or an MatchedSources object.  
    Output : - A MatchedSources object.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix({rand(100,200),rand(100,200)},{'FLUX','MAG'})  
    MS.write('try.hdf5')  
    clear MS;  
    MS = MatchedSources.read('try.hdf5');  
    MS1 = MatchedSources.read('try.hdf5','Fields','FLUX');  
    delete('try.hdf5');  
      


### statSummary

Calculate statistical summary properties of a data property in a MatchedSources object.


    
    Calculate statistical summary properties of a data property in a  
    MatchedSources object.  
    Input  : - A MatchedSources object.  
    - A cell array of dictionary field names for the  
    data property for which to calculate statistics.  
    Output : - A structure array with the column wise (sources)  
    basic statistcs properties for the sources in data  
    properties. E.g., the mean, median, std, etc, for  
    each source.  
    Author : Eran Ofek (Sep 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX')  
    MS.addMatrix({rand(100,200), rand(100,200), rand(100,200)},{'MAG','X','Y'})  
    Result = statSummary(MS);  
      


### summary

Summary of a specific field matrix in MatchedSources


    
    Summary of a specific field matrix in MatchedSources  
    Input  : - A single element MatchedSources object.  
    - A char array of field name. If empty, use the  
    first field. Default is ''.  
    Output : - A structure of summary information  
    Author : Eran Ofek (Jun 2021)  
    Example: MS=MatchedSources;  
    MS.addMatrix(rand(100,200),'FLUX');  
    MS.summary  
    MS.summary('FLUX')  
      


### unitTest

unitTest for MatchedSources class


    
    unitTest for MatchedSources class  
      
    write  


### write

Write a MatchedSources object to HDF5 or mat file


    
    Write a MatchedSources object to HDF5 or mat file  
    Input  : - A single element MatchedSources object.  
    - FileName to write.  
    * ...,key,val,...  
    'FileType' - Options are:  
    ['hdf5'] - HDF5 file with dataset named like  
    the field names.  
    'mat' - Save the Data struct to a mat file.  
    'matobj' - Save the entire MatchedSource object to  
    a mat file.  
    Output : - Return true if sucess.  
    Author : Eran Ofek (Jun 2021)  
    Example: MS = MatchedSources;  
    MS.addMatrix({rand(100,200),rand(100,200)},{'FLUX','MAG'})  
    MS.write('try.hdf5')  
      


