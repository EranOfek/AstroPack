# Class: Tran2D



    
    Tran2D class: An astrometric transformation class  
    Description: A 2D transformation object designed for astrometric  
    transformations of 2D images.  
    It supports linear transformations of the form:  
    Xi = c1*FunX{1}(x,y,add_par) + c2*Fun{2}(...) + ...  
    Yi = ...  
    FunX are user defined functionals  
    x,y are the coordinates after applying a normalization  
    transformation stored in FunNX and FunNY with parameters in  
    ParNX and ParNY, respectively.  
    add_par are additional parameters like color, airmass, and  
    parallactic angle.  
    Variable naming: Class names has lower-case letter followed by "Cl".  
    Properties names start with capital letter.  
    Method names start with lower-case letter  
    Variable names usually start with capital letter.  
    Tested : Matlab R2018a  
    Author : Eran O. Ofek (Jun 2020)  
    URL : http://weizmann.ac.il/home/eofek/matlab/  
    Properties  
    ColCell - A cell array of variable names on which the  
    transformation depends. Usually, the first two are 'x' and 'y'.  
    The other may be variables like color and airmass.  
    This variables represents the arguments of the FunX and FunY  
    functionals.  
    FunX - A cell array of function_handles (called functionals)  
    The functionals represents the linear transformation of the  
    form:  
    Xi = c1*FunX{1}(x,y,add_par) + c2*Fun{2}(...) + ...  
    FunY - Like FunX, but for the Y axis.  
    FunNX - A function handle that represent the normalization  
    transformation on the X-axis, prior to the FunX transformation.  
    Default is @(x,nx1,nx2) (x-nx1)./nx2;  
    FunNY - Like FunNX, but for the Y axis.  
    ParX - A vector of arguments of the FunX transformation  
    coeficients.  
    ParY - Like ParX, but for the Y axis.  
    ParNX - A vector of coeficients for the X-axis normalization  
    transformation.  
    ParNY - Like ParNX, but for the Y axis.  
    FitData - Addition data regarding the quality of the fit.  
    PolyRep - A structure containing the polynomial representation of  
    the transformation. The following fields are available:  
      
    Methods (static)  
    isTran2D - Return true if a Tran2D object.  
    selected_trans - Return predefined 2D transformations.  
    functionals2symPoly - Construct a symbolic polynomials from functionals  
    functionals2polyCoef - Given functionals and their polynomial  
    representation generated by  
    Tran2D.functionals2symPoly, collect the  
    polynomial coeffocients and calculate their values.  
    Methods  
    design_matrix - construct design matrices for a position.  
    nfuns - Count number of free linear parameters in FunX and FunY  
    isParKnown - Check if number of parameters is consistent with number of functionals.  
    forward - Applay forward transformation to coordinates.  
    backward - Applay backward transformation to coordinates.  
    fit_simple - A simple fit (no errors/iterations) of a data to the transformation.  
    symPoly - Construct a symbolic polynomials from a Tran2D object  
    Populate the PolyRep.PX, PY, CX, CY psymbolic functions.  
    polyCoef - Convert a Tran2D object and parameters to polynomial coefficients  
    symPoly2deg -Return the X and Y poly deg vectors of the polynomial representations  
    polyRep - Update the PolyRep polynomial representation property  
      
    Examples  
    Construct a Tran2Dobject with 3rd order checyshev  
    T=Tran2D;  
    Construct a design matrix, H, for the transformation  
    such that x = Hx*Par  
    Coo = rand(10,2);  
    [Hx,Hy]=design_matrix(T,Coo)  
      
    populate the coef.  
    TC=Tran2D; TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13);  
    TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;  
    TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;  
    forward and backward transformations  
    [Xf,Yf]=forward(TC,[1 1.3;2 6;3 3]);  
    [X,Y]=backward(TC,Xf, Yf);  
      
    Symbolic representations of polynomials:  
    E.g., converting Chebyshev functionals to regular polynomials.  
    The functionals2symPoly static function returns the symbolic  
    representation of the original functionals.  
    CX,CY is an array of symbolic functions of the coeficienst of the  
    polynomial functionals.  
    PX, PY are the polynomials functionals.  
    TC=Tran2D;  
    [CX,CY,PX,PY] = Tran2D.functionals2symPoly(TC.ColCell,TC.FunX,TC.FunY,TC.FunNX,TC.FunNY);  
    symPoly is a method of Tran2D that populate the PolyRep with  
    the CX, CY, PX, PY symbolic functions.  
    This function is slow and should be run once the Tran2D was constructed.  
    [CX,CY,PX,PY]=symPoly(TC);  
    Next populate the ParX, ParY:  
    TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13);  
    TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;  
    TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;  
    Calculate the numerical value of the polynomials coef.  
    The coef. are populated in: TC.PolyRep.PolyParX, PolyParY:  
    [PolyCoefX, PolyCoefY, PX, PY] = TC.polyCoef  
    Return the X and Y poly deg vectors of the polynomial representations  
    and populate them in PolyRep:  
    [PolyX_Xdeg,PolyX_Ydeg,PolyY_Xdeg,PolyY_Ydeg]=symPoly2deg(TC)  
      
    Update/repopulate the PolyRep polynomial representation property  
    TC = Tran2D;  
    TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13);  
    TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;  
    TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;  
    TC=polyRep(TC, true)  
      
      
      
      

### Functions List

    Tran2D - Tran2D class constructor Package: @Tran2D
    backward - Applay backward transformation to coordinates Package: @Tran2D
    design_matrix - construct design matrices for a position Package: @Tran2D Description: Construct a design matrices (for X and Y coordinates) given a Tran2D object and a list of coordinates. The coordinates must contain at
    fitAstrometricTran - Fit astrometric transformation
    fitDesignMatrix - Example: [Result, Obj] = fitDesignMatrix(Obj, Hx, Hy, X, Y, Args)
    fit_simple - A simple fit (no errors/iterations) of a data to the transformation Package: @Tran2D
    forward - Applay forward transformation to coordinates Package: @Tran2D
    functionals2polyCoef - Convert functionals and parameters to polynomial coefficients Package: @Tran2D (Static) Description: Given functionals and their polynomial representation generated by Tran2D.functionals2symPoly, collect the
    functionals2symPoly - Construct a symbolic polynomials from functionals Package: @Tran2D (Static) Description: Given a cell array of anonymous function in X and Y, and normalization anonymous function, and a cell array of argument names. Construct an array of
    help - mlx help for Tran2D
    isParKnown - Check if number of parameters is consistent with number of functionals. Package: @Tran2D
    isTran2D - Check if object is a Tran2D object Package: @Tran2D (Static) Example: Tran2D.isTran2D(Obj)
    nfuns - count number of free linear parameters in FunX and FunY Package: @trand2Cl
    polyCoef - Convert a Tran2D object and parameters to polynomial coefficients Package: @Tran2D Description: Use Tran2D.functionals2polyCoef to populate the numerical value of the coefficients of the transfornmation polynomial representation.
    polyRep - Update the PolyRep polynomial representation property Package: @Tran2D Description: Update or populate the PolyRep property in the Tran2D object. This propert contains the polynomial representation of the transformation
    selected_trans - Return predefined 2d transformations Package: @Tran2D (Static)
    set.ColCell - setter for the Tran2D ColCell property
    set.FunX - setter for the Tran2D FunX property
    set.FunY - setter for the Tran2D FunY property
    sym2anonymousFunction - 
    symPoly - Construct a symbolic polynomials from a Tran2D object Package: @Tran2D Description: Construct a symbolic polynomials from a Tran2D object using Tran2D.functionals2symPoly and store the symbolic functions in the PolyRep
    symPoly2deg - Return the X and Y poly deg vectors of the polynomial representations Package: @Tran2D Description: The PolyRep.PX/PY contains the symbolic polynomial representation. This function calculate the deg of X and Y polynomial in each
    unitTest - unitTest for Tran2D class Example: Tran2D.unitTest

### Tran2D

Tran2D class constructor Package: @Tran2D


    
    Tran2D class constructor  
    Package: @Tran2D  
    Input  : * Arbitrary number of strings each represents  
    a transformation functionals (see  
    Tran2D.selected_trans for options).  
    Each transformation will populate one element.  
    Alternatively, this is a number of elements.  
    Default is 'cheby1_3'.  
    Output : - A Tran2D object  
    Example: TC=Tran2D  
    TC=Tran2D(2)  
    TC=Tran2D('cheby1_3_c1','cheby1_2');  
      


### backward

Applay backward transformation to coordinates Package: @Tran2D


    
    Applay backward transformation to coordinates  
    Package: @Tran2D  
    Input  : - A Tran2D object  
    - A matrix of coordinates, line per point.  
    The matrix must contains at least two columns  
    [X,Y]. The other columns are assumed to be the  
    coordinates listed in the ColCell property of the  
    Tran2D object. If the other coordinates are not  
    provided then they assumed to be zero.  
    Alternatively, two arguments X,Y.  
    Output : - X coordinate after applaying the backward  
    transformation.  
    - Y coordinate after applaying the backward  
    transformation.  
    Example: TC=Tran2D; TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13);  
    TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;  
    TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;  
    [Xf,Yf]=forward(TC,[1 1.3;2 6;3 3]);  
    [X,Y]=backward(TC,[Xf, Yf]);  
      


### design_matrix

construct design matrices for a position Package: @Tran2D Description: Construct a design matrices (for X and Y coordinates) given a Tran2D object and a list of coordinates. The coordinates must contain at


    
    construct design matrices for a position  
    Package: @Tran2D  
    Description: Construct a design matrices (for X and Y  
    coordinates) given a Tran2D object and a list  
    of coordinates. The coordinates must contain at  
    least two columns [X,Y], but may include  
    additional coordinates (e.g., Color, AM, PA).  
    Input  : - A Tran2D object  
    - A matrix of coordinates with minimum of two  
    columns [X,Y].  
    The i-th column is the i-th input argument of each  
    one of the functionals in FunX, FunY.  
    The X and Y coordinates are normalized using the  
    FunNX and FunNY functions.  
    Alternatively, this can be an N-element cell  
    array, where each element contains a vector of  
    coordinates.  
    Output : - Design matrix of X coordinates.  
    - Design matrix of Y coordinates.  
    Example: [Hx,Hy]=design_matrix(T,[1 1])  
      


### fitAstrometricTran

Fit astrometric transformation


    
    Fit astrometric transformation  
    Input  : - A single-element Tran2D object  
    - Vector of X coordinate (independent variable)  
    - Vector of Y coordinate (independent variable)  
    - Vector of X coordinate (dependent variable)  
    - Vector of Y coordinate (dependent variable)  
    * ...,key,val,...  
    'UseFlag' - A vector of logicals indicating which  
    sources (in the vectors of coordinates) to  
    use. Default is true.  
    'ExtraData' - Additional columns of independent  
    variables to pass to the transformation  
    functionals. E.g., [Color, AM, PA].  
    Default is [].  
    'Mag' - A Vector of magnitude per source.  
    'ErrPos' - A vector of positional errors per  
    source. In the 2nd iteration, this will be  
    added in quadrature to the resid vs. ma.  
    errors.  
    Default is 0.01.  
    'Niter' - Number of iterations. Default is 2.  
    'FitMethod' - '\', ['lscov'].  
    'MaxResid' - Maximum residual to use in fit.  
    Default is 1.  
    'MagRange' - [Min Max] max range. Default is [].  
    'BinMethod' - Method to use:  
    'poly' - polynomial fit.  
    'bin' - binning the data.  
    Default is 'bin'  
    'PolyDeg' - Polynomial degree for the polynomial fit.  
    Default is 3.  
    'BinSize' - Bin size for binning. Default is 1 (mag).  
    'FunMean' - A function handle to use when calculating the mean  
    of the data in each bin.  
    Default is @nanmedian.  
    'FunStd' - A function handle to use when calculating the std  
    of the data in each bin, or when calculating the global  
    std after the polynomial fit.  
    Default is @imUttil.background.rstd.  
    'InterpMethod' - Interpolation method. Default is 'linear'.  
    'ThresholdSigma' - Threshold in sigmas (std) for flagging good  
    data. Default is 3.  
    Output : - A Tran2D object with the ParX, ParY, ErrParX,  
    ErrParY populated.  
    - A structure of fit quality parameters.  
    Authors: Eran Ofek (Jul 2021)  
    Example: [Tran, Res] = fitAstrometricTran(Tran,Xind,Yind, Xdep,Ydep);  
      


### fitDesignMatrix

Example: [Result, Obj] = fitDesignMatrix(Obj, Hx, Hy, X, Y, Args)


    
      
    Example: [Result, Obj] = fitDesignMatrix(Obj, Hx, Hy, X, Y, Args)  
      


### fit_simple

A simple fit (no errors/iterations) of a data to the transformation Package: @Tran2D


    
    A simple fit (no errors/iterations) of a data to the transformation  
    Package: @Tran2D  
    Input  : - An Tran2D object  
    - A matrix of reference [X, Y] coordinates to fit.  
    - A vector of catalog X or Y coordinates to fit.  
    Output : - The Tran2D object with the best fit parameters.  
      


### forward

Applay forward transformation to coordinates Package: @Tran2D


    
    Applay forward transformation to coordinates  
    Package: @Tran2D  
    Input  : - A Tran2D object  
    - A matrix of coordinates, line per point.  
    The matrix must contains at least two columns  
    [X,Y]. The other columns are assumed to be the  
    coordinates listed in the ColCell property of the  
    Tran2D object. If the other coordinates are not  
    provided then they assumed to be zero.  
    Alternatively, two arguments, X, Y.  
    Output : - X coordinate after applaying the forward  
    transformation.  
    - Y coordinate after applaying the forward  
    transformation.  
    Example: TC=Tran2D; TC.ParY=ones(1,13);  TC.ParX=ones(1,13);  
    [Xf,Yf]=forward(TC,[1 1;2 1])  
      


### functionals2polyCoef

Convert functionals and parameters to polynomial coefficients Package: @Tran2D (Static) Description: Given functionals and their polynomial representation generated by Tran2D.functionals2symPoly, collect the


    
    Convert functionals and parameters to polynomial coefficients  
    Package: @Tran2D (Static)  
    Description: Given functionals and their polynomial  
    representation generated by  
    Tran2D.functionals2symPoly, collect the  
    polynomial coeffocients and calculate their  
    values.  
    Input  : - CX (output of Tran2D.functionals2symPoly)  
    - CY (output of Tran2D.functionals2symPoly)  
    - PX (output of Tran2D.functionals2symPoly)  
    - PY (output of Tran2D.functionals2symPoly)  
    - Cell array of functional argument names.  
    - Values of the parameters of the X functionals.  
    - Values of the parameters of the Y functionals.  
    - Values of the parameters of the X normalization.  
    - Values of the parameters of the Y normalization.  
    - The values of the additional coordinates.  
    Default is 0 for all coordinates.  
    Output : - Vector of coefficients of the polynomials in PX.  
    - Vector of coefficients of the polynomials in PY.  
      


### functionals2symPoly

Construct a symbolic polynomials from functionals Package: @Tran2D (Static) Description: Given a cell array of anonymous function in X and Y, and normalization anonymous function, and a cell array of argument names. Construct an array of


    
    Construct a symbolic polynomials from functionals  
    Package: @Tran2D (Static)  
    Description: Given a cell array of anonymous function in X and Y,  
    and normalization anonymous function, and a cell  
    array of argument names. Construct an array of  
    symbolic polynomials and their coefficients.  
    Input  : - A Tran2D object.  
    Output : - A vector of symbolic functions, one per X  
    functional. These are the coefficients of the  
    polynomial that represents the FunX functionals.  
    - The same but for Y.  
    - A cector of symbolic functions, one per X  
    functional. These are the polynomial terms  
    corresponding for each of the coefficients.  
    - The same but for Y.  
    Example: TC=Tran2D;  
    [CX,CY,PX,PY]=Tran2D.functionals2symPoly(TC.ColCell,TC.FunX,TC.FunY,TC.FunNX,TC.FunNY);  
      


### help

mlx help for Tran2D


    
    mlx help for Tran2D  


### isParKnown

Check if number of parameters is consistent with number of functionals. Package: @Tran2D


    
    Check if number of parameters is consistent with number of functionals.  
    Package: @Tran2D  
    Input  : - A Tran2D object.  
    Output : - True if number of parameters equal to the number  
    of functionals in both X and Y. Otherwise false.  
      


### isTran2D

Check if object is a Tran2D object Package: @Tran2D (Static) Example: Tran2D.isTran2D(Obj)


    
    Check if object is a Tran2D object  
    Package: @Tran2D (Static)  
    Example: Tran2D.isTran2D(Obj)  
      


### nfuns

count number of free linear parameters in FunX and FunY Package: @trand2Cl


    
    count number of free linear parameters in FunX and FunY  
    Package: @trand2Cl  
    Input  : - A Tran2D object  
    Output : - Number of functionals (or free parameters) in X.  
    - Number of functionals (or free parameters) in Y.  
      


### polyCoef

Convert a Tran2D object and parameters to polynomial coefficients Package: @Tran2D Description: Use Tran2D.functionals2polyCoef to populate the numerical value of the coefficients of the transfornmation polynomial representation.


    
    Convert a Tran2D object and parameters to polynomial coefficients  
    Package: @Tran2D  
    Description: Use Tran2D.functionals2polyCoef to populate  
    the numerical value of the coefficients of the  
    transfornmation polynomial representation.  
    This function update the PolyRep.PolyParX and  
    PolyRep.PolyParY in the Tran2D object.  
    If these properties already exist,  
    then they will not be calculated again.  
    Input  : - A Tran2D object.  
    - Vector of the value for the additional parameters in  
    TC.ColCell after [x,y]. For example, if ColCell is  
    {'x','y','c','AM',PA'}, then these are the value  
    of 'c','AM','PA' at which the polynomials coef.  
    are evaluate at.  
    Default is 0 for all the parameters.  
    Output : - Vector of the values of the numerical coefficients  
    of the polynomial representation of FunX.  
    - Vector of the values of the numerical coefficients  
    of the polynomial representation of FunY.  
    - An array of symbolic polynomials corresponding to  
    the coeffcients in X.  
    - An array of symbolic polynomials corresponding to  
    the coeffcients in Y.  
    Example: TC = Tran2D;  TC.symPoly  
    TC.polyCoef  
      


### polyRep

Update the PolyRep polynomial representation property Package: @Tran2D Description: Update or populate the PolyRep property in the Tran2D object. This propert contains the polynomial representation of the transformation


    
    Update the PolyRep polynomial representation property  
    Package: @Tran2D  
    Description: Update or populate the PolyRep property in the  
    Tran2D object. This propert contains the  
    polynomial representation of the transformation  
    object.  
    Input  : - A Tran2D object.  
    - A logical parameter indicating if to re-populate  
    PolyRep property even if it is already exist  
    (true), or to calculate it only if it doesn't  
    exist (false).  
    Default is false.  
    Output : null - update the PolyRep property  
    Example: TC.polyRep  
      


### selected_trans

Return predefined 2d transformations Package: @Tran2D (Static)


    
    Return predefined 2d transformations  
    Package: @Tran2D (Static)  
    Input  : - Transformation name. Avialable transformations  
    are:  
    'cheby1_3_c1' - Fitsr kind Chebyshev polynomials  
    of the 3rd degree + color term of the first degree.  
    'cheby1_3' -  Fitsr kind Chebyshev polynomials  
    of the 3rd degree.  
    'cheby1_4' -  Fitsr kind Chebyshev polynomials  
    of the 4th degree.  
    'cheby1_4_c1' - Fitsr kind Chebyshev polynomials  
    of the 4th degre + color term of the first degree.  
    'cheby1_2' -  Fitsr kind Chebyshev polynomials  
    of the 2nd degree.  
    'poly1' - 1st deg polynomials.  
    'poly2' - 2nd deg polynomials.  
    'poly3' - 3rd deg polynomials.  
    'poly1_tiptilt' - 1st deg polynomials + 2 tip/tilt  
    terms.  
    Output : - A cell array of functionals for X coordinates.  
    - A cell array of functionals for Y coordinates.  
    - A cell array of argume names.  
    By default this is {'x','y','c','AM','PA'}.  
    - For the X functional, vector of degree of X polynomial for each  
    functional. This is available only for simple  
    polynomials, otherwise empty.  
    - VFor the X functional, vector of degree of Y polynomial for each  
    functional. This is available only for simple  
    polynomials, otherwise empty.  
    - For the Y functional, vector of degree of X polynomial for each  
    functional. This is available only for simple  
    polynomials, otherwise empty.  
    - VFor the Y functional, vector of degree of Y polynomial for each  
    functional. This is available only for simple  
    polynomials, otherwise empty.  
    Example:  
    [FunX,FunY,ColCell]=Tran2D.selected_trans('cheby1_3_c1')  
      


### set.ColCell

setter for the Tran2D ColCell property


    
    setter for the Tran2D ColCell property  
      


### set.FunX

setter for the Tran2D FunX property


    
    setter for the Tran2D FunX property  
      


### set.FunY

setter for the Tran2D FunY property


    
    setter for the Tran2D FunY property  
      


### sym2anonymousFunction




    
      
    populate the symbolic functions (if not populated)  


### symPoly

Construct a symbolic polynomials from a Tran2D object Package: @Tran2D Description: Construct a symbolic polynomials from a Tran2D object using Tran2D.functionals2symPoly and store the symbolic functions in the PolyRep


    
    Construct a symbolic polynomials from a Tran2D object  
    Package: @Tran2D  
    Description: Construct a symbolic polynomials from a  
    Tran2D object using Tran2D.functionals2symPoly  
    and store the symbolic functions in the PolyRep  
    property.  
    This function update the PolyRep.PX,PY,CX,CY  
    properties. If these properties already exist,  
    then they will not be calculated again.  
    Input  : - A Tran2D object.  
    Output : - A vector of symbolic functions, one per X  
    functional. These are the coefficients of the  
    polynomial that represents the FunX functionals.  
    - The same but for Y.  
    - A cector of symbolic functions, one per X  
    functional. These are the polynomial terms  
    corresponding for each of the coefficients.  
    - The same but for Y.  
    Example: [CX,CY,PX,PY]=symPoly(TC);  
      


### symPoly2deg

Return the X and Y poly deg vectors of the polynomial representations Package: @Tran2D Description: The PolyRep.PX/PY contains the symbolic polynomial representation. This function calculate the deg of X and Y polynomial in each


    
    Return the X and Y poly deg vectors of the polynomial representations  
    Package: @Tran2D  
    Description: The PolyRep.PX/PY contains the symbolic  
    polynomial representation. This function  
    calculate the deg of X and Y polynomial in each  
    elemnt of the symbolic vector. For example, for  
    PX with x^3*y it will return: PolyX_Xdeg=3  
    and PolyX_Ydeg=1.  
    If these properties already exist,  
    then they will not be calculated again.  
    Input  : - A Tran2D object  
    Output : - A vector of the polynomial degrees of X in the  
    PolyRep.PX vector.  
    - A vector of the polynomial degrees of Y in the  
    PolyRep.PX vector.  
    - A vector of the polynomial degrees of X in the  
    PolyRep.PY vector.  
    - A vector of the polynomial degrees of Y in the  
    PolyRep.PY vector.  
    Example: [PolyX_Xdeg,PolyX_Ydeg,PolyY_Xdeg,PolyY_Ydeg]=symPoly2deg(TC)  
      


### unitTest

unitTest for Tran2D class Example: Tran2D.unitTest


    
    unitTest for Tran2D class  
    Example: Tran2D.unitTest  
      


