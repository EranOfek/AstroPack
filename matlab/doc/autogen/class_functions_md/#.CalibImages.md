# Class: CalibImages



    
    CalibImages class - A class for storing calibration image, and performs  
    the basic calibration steps on images.  
    Description: Each element of this class may contain all the calibration  
    images for a single detector or a section of a detector.  
    This allows performing calibration for multiple detectors  
    simultaneously.  
      
      
      
    use case:  
    1. create dark/bias/flat/fringe  
    bias  
    dark  
    flat  
    fringe  
    2. save to disk/db  
    writeImages  
    write2DB  
    3. upload from disk/db  
    readImages - read calibration images from disk  
    searchDB - search recent calibration files  
    4. apply calib on image  
    Each calib element corresond to one sub/image  
    debias  
    dedark  
    deflat  
    defringe  
    maskSaturated  
    calibrate (do all)  
      
      

### Functions List

    CalibImages - Constructor for the CalibImages class
    checkObjImageSize - Check the validity of the size (number of elements) of CalibImages object and input image This function will return an error if not one of the following: size(Image)size(Obj) or (numel(Obj)1 and numel(Image)>1)');
    createBias - Create master bias using imProc.dark.bias and store in CalibImages object. Optionaly, can break the bias image to sub images and store them in different elements of the CalibImages object.
    createFlat - Create a Flat image for all filters and populate in CalibImages object. Given a list of dark-subtracted images, identify flat images taken at a each filter, and generate a flat images. The flat image is added into the array of Flat images in the CalibImages object.
    createFlatFilter - Create a Flat image for specific filter and populate in CalibImages object. Given a list of dark-subtracted images, identify flat images taken at a specific filter, and generate a flat image. The flat image is added into the array of Flat images in the CalibImages object.
    debias - Subtract bias image from an image and update mask.
    deflat - Divide from image from an image and update mask (multiple filters).
    overscan - Subtract and remove overscan bias from image.
    processImages - Perform basic calibration (bias, flat, etc) to input images Perform the following steps on an image: Create a mask image Flag staturated pixels in mask Subtract bias image
    set.Dark - setter for Dark property - set DarkExpTime+darkTemp from Header
    set.Flat - setter for Flat property - set FlatFilter from Header
    set.Fringe - setter for Fringe property - set FringeExpTime+FringeFilter from Header
    unitTest - unitTest for CalibImages class

### CalibImages

Constructor for the CalibImages class


    
    Constructor for the CalibImages class  
    Input  : * ...,key,val,...  
    'Bias' - A Bias AstroImage  
    'Dark' - A Dark AstroImage (per ExpTime)  
    'Flat' - A Flat AstroImage (per filter)  
    'Fringe' - A fringe AstroImage (per filter)  
    'FlatFilter' -  
    'DarkExpTime'  
    'DarkTemp'  
    'FringeFilter'  
    'FringeExpTime'  
      
    Output : - A CalibImages object  
    Author : Eran Ofek (Aug 2021)  
    Example:  
      


### checkObjImageSize

Check the validity of the size (number of elements) of CalibImages object and input image This function will return an error if not one of the following: size(Image)size(Obj) or (numel(Obj)1 and numel(Image)>1)');


    
    Check the validity of the size (number of elements) of CalibImages object and input image  
    This function will return an error if not one of the  
    following: size(Image)size(Obj) or (numel(Obj)1 and numel(Image)>1)');  
    Input  : - A CalibImages object.  
    - An AstroImage object  
    Output : - Number of elements in the CalibImages object.  
    - Number of elements in the AstroImage object.  
    Author : Eran Ofek (Jul 2021)  
      


### createBias

Create master bias using imProc.dark.bias and store in CalibImages object. Optionaly, can break the bias image to sub images and store them in different elements of the CalibImages object.


    
    Create master bias using imProc.dark.bias and store in CalibImages object.  
    Optionaly, can break the bias image to sub images and store  
    them in different elements of the CalibImages object.  
    Input  : - An CalibImages object  
    - A list of AstroImages, or a cell array of file  
    names, or a a template of file names (interpreted  
    using regular expressions).  
    * ...,key,val,...  
    'BiasArgs' - A cell array of additional arguments  
    to pass to the imProc.dark.bias function.  
    Default is {}.  
    'BlockSize' - Sub images block size to generate.  
    If empty, use the orginal image size and  
    return a single element CalibImages object.  
    Otherwise return multi-element CalibImages  
    object with a sub (bias) image per element.  
    'image2subimagesArgs' - A cell array of additional  
    arguments to pass to imProc.image.image2subimages  
    function. Default is {}.  
    Output : - A CalibImages object with the Bias field  
    populated. This is an handle to the original input  
    object.  
    Author : Eran Ofek (Jul 2021)  
    Example: cd /data/euler/archive/AstroPack/data/LAST/TestImages  
    CI = CalibImages;  
    CI.createBias('LAST*_dark.fits');  
      


### createFlat

Create a Flat image for all filters and populate in CalibImages object. Given a list of dark-subtracted images, identify flat images taken at a each filter, and generate a flat images. The flat image is added into the array of Flat images in the CalibImages object.


    
    Create a Flat image for all filters and populate in CalibImages object.  
    Given a list of dark-subtracted images, identify flat images taken at a  
    each filter, and generate a flat images. The flat  
    image is added into the array of Flat images in the  
    CalibImages object.  
    Input  : - An CalibImages object (dark subtracted).  
    - An AstroImage array containing images from which  
    to construct flat images.  
    The flat images in the specific filter are  
    detected by the code.  
    * ...,key,val,...  
    'FilterKey' - The header keyword name containing the  
    filter name. By defdault the search is done using  
    the synonyms dictionary, so if needed add  
    the keyword name to the Header.Synonyms.KeyNames.yml  
    Default is 'FILTER'.  
    'UseFilters' - A cell array of filters for which  
    to generate flats. If empty, then search  
    for all possible filters and constrcu flat  
    for each one. Default is {}.  
    'IgnoreFilters' - If 'UseFilters' is empty, then  
    you can provide here a cell array of filter  
    names for which not to generate flat image.  
    Default is {}.  
    'getStructKeyArgs' - A cell array of additional  
    arguments to pass to getStructKey.  
    Default is {}.  
    'isFlatArgs' - A cell array of additional  
    arguments to pass to imProc.flat.isFlat.  
    Default is {}.  
    'flatArgs' - A cell array of additional  
    arguments to pass to imProc.flat.flat.  
    Default is {}.  
    Output : - A CalibImages object in which the new flat is  
    populated.  
    Author : Eran Ofek (Oct 2021)  
    Example:  
      


### createFlatFilter

Create a Flat image for specific filter and populate in CalibImages object. Given a list of dark-subtracted images, identify flat images taken at a specific filter, and generate a flat image. The flat image is added into the array of Flat images in the CalibImages object.


    
    Create a Flat image for specific filter and populate in CalibImages object.  
    Given a list of dark-subtracted images, identify flat images taken at a  
    specific filter, and generate a flat image. The flat  
    image is added into the array of Flat images in the  
    CalibImages object.  
    Input  : - An CalibImages object (dark-subtracted).  
    - An AstroImage array containing images from which  
    to construct flat images.  
    The flat images in the specific filter are  
    detected by the code.  
    - Filter name for which to create the flat.  
    * ...,key,val,...  
    'FilterKey' - The header keyword name containing the  
    filter name. By defdault the search is done using  
    the synonyms dictionary, so if needed add  
    the keyword name to the Header.Synonyms.KeyNames.yml  
    Default is 'FILTER'.  
    'IsFilterFlat' - A vector of logicals or empty.  
    If empty, then the flat images at the  
    specific filter will be selected  
    automatically. Alternatively, this can be a  
    vector of logicals indicating which images  
    to use. If a scalar true, then use all the  
    images. Default is [].  
    'FilterList' - An optional cell array of filter  
    per image. If empty, will be generated.  
    Default is [].  
    'getStructKeyArgs' - A cell array of additional  
    arguments to pass to getStructKey.  
    Default is {}.  
    'isFlatArgs' - A cell array of additional  
    arguments to pass to imProc.flat.isFlat.  
    Default is {}.  
    'flatArgs' - A cell array of additional  
    arguments to pass to imProc.flat.flat.  
    Default is {}.  
    Output : - A CalibImages object in which the new flat is  
    populated.  
    Author : Eran Ofek (Oct 2021)  
    Example:  
      


### debias

Subtract bias image from an image and update mask.


    
    Subtract bias image from an image and update mask.  
    Input  : - A CalibImages object.  
    If this is a single-element object, then the bias  
    image will subtrcated from all input images.  
    If this is a multi-element object, then the input  
    must have the same number of elements, ane the  
    bias subtraction will be done element-by-element.  
    - An AstroImage object containing the input image  
    from which to subtract the bias image.  
    * ...,key,val,...  
    'CreateNewObj' - [false] | true.  
    If true, then create a new copy of the  
    images input. Default is false.  
    Note that the CalibImage itself is not  
    copied.  
    'debiasArgs' - A cell array of additional  
    arguments to pass to the imProc.dark.debias  
    function. Default is {}.  
    Output : - The AstroImage object, from which the bias was  
    subtrcated.  
    See also: imProc.dark.debias  
    Author : Eran Ofek (Jul 2021)  
    Example: debias(Obj, Image)  
      


### deflat

Divide from image from an image and update mask (multiple filters).


    
    Divide from image from an image and update mask (multiple filters).  
    Input  : - A CalibImages object.  
    If this is a single-element object, then the flat  
    image will divide from all input images.  
    If this is a multi-element object, then the input  
    must have the same number of elements, ane the  
    flat division will be done element-by-element.  
    - An AstroImage object containing the input image  
    from which to divide the flat image.  
    The image should be bias/dark subtracted.  
    * ...,key,val,...  
    'CreateNewObj' - [false] | true.  
    If true, then create a new copy of the  
    images input. Default is false.  
    Note that the CalibImage itself is not  
    copied.  
    'FilterKey' - The header keyword name containing the  
    filter name. By defdault the search is done using  
    the synonyms dictionary, so if needed add  
    the keyword name to the Header.Synonyms.KeyNames.yml  
    Default is 'FILTER'.  
    'FilterList' - An optional cell array of filter  
    per image. If empty, will be generated.  
    Default is [].  
    'getStructKeyArgs' - A cell array of additional  
    arguments to pass to getStructKey.  
    Default is {}.  
    'deflatArgs' - A cell array of additional  
    arguments to pass to the imProc.flat.deflat  
    function. Default is {}.  
    Output : - The AstroImage object, from which the bias was  
    subtrcated.  
    See also: imProc.dark.debias  
    Author : Eran Ofek (Jul 2021)  
    Example: debias(Obj, Image)  
      


### overscan

Subtract and remove overscan bias from image.


    
    Subtract and remove overscan bias from image.  
    Input  : - A CalibImages object.  
    Not used.  
    - An AstroImage object containing the input image  
    from which to subtract the bias image.  
    * ...,key,val,...  
    'CreateNewObj' - [false] | true.  
    Indicating of to create a new copy of the  
    input image. Default is false.  
    'OverScan' - Either an header keyword containing  
    the overscan region, or an [Xmin Xmax Ymin Ymax]  
    vector for the overscan.  
    Default is 'OVERSCAN'.  
    'OverScanDir' - Indicating the direction of the overscan:  
    'x'|'y'|1|2| [].  
    See imProc.dark.overscan for details.  
    Default is [].  
    'Method' - Method by which to calculate the overscan:  
    See imProc.dark.overscan for details.  
    Default is 'globalmedian'.  
    'MethodArgs' - A cell array of additional  
    arguments to pass to the method.  
    (Defaults are defined for each medthod).  
    Output : - The AstroImage object, from which the overscan was  
    subtrcated and removed.  
    See also: imProc.dark.overscan  
    Author : Eran Ofek (Jul 2021)  
    Example:  
      


### processImages

Perform basic calibration (bias, flat, etc) to input images Perform the following steps on an image: Create a mask image Flag staturated pixels in mask Subtract bias image


    
    Perform basic calibration (bias, flat, etc) to input images  
    Perform the following steps on an image:  
    Create a mask image  
    Flag staturated pixels in mask  
    Subtract bias image  
    Subtract and remove overscan from image  
    Divide image by flat  
    Correct for fringing  
    Multiple image by gain  
    Input : - A CalibImages object.  
    Each element in the CalibImages must correspond to  
    an image in the AstroImage input object.  
    - An AstroImage object.  
    Number of elements must be equal to the number of  
    elements in the CalibImages object, or if the  
    CalibImages object is of size=1, then this may have  
    any size.  
    * ...,key,val,...  
    'CreateNewObj' - [], false, true. Default is [].  
    'BitDictinaryName' - Bit dictionary name.  
    Default is 'BitMask.Image.Default'.  
    'MaskSaturated' - A logical indicating if to flag  
    saturated pixels, in the Mask image.  
    Default is true.  
    'maskSaturatedArgs' - A cell array of additional  
    arguments to pass to imProc.mask.maskSaturated  
    Default is {}.  
    'debiasArgs' - A cell array of additional  
    arguments to pass to imProc.dark.debias.  
    Default is {}.  
    'SubtractOverscan' - A logical indicating if to  
    subtract overscan. Default is true.  
    'MethodOverScan' - see imProc.dark.overscan.  
    Default is 'globalmedian'.  
    'deflatArgs' - A cell array of additional  
    arguments to pass to imProc.flat.deflat.  
    Default is {}.  
    'CorrectFringing' - A logical indicating if to  
    correct fringing. Default is false.  
    'MultiplyByGain' - A logical indicating if to  
    multiply image values by gain.  
    Default is true.  
    'InterpolateOberSaturated' - A logical indicating  
    if to interpolate over saturated pixels and NaNs.  
    Default is true.  
    'Bitname_Saturated' - Satuarted pixels bitmask  
    name. Default is 'Saturated'.  
    'interpOverNanArgs' - A cell array of additional  
    arguments to pass to imProc.image.interpOverNan.  
    Default is {}.  
    Output : - The output AstroImage after calibration.  
    Author : Eran Ofek (Oct 2021)  
    Example:  
      


### set.Dark

setter for Dark property - set DarkExpTime+darkTemp from Header


    
    setter for Dark property - set DarkExpTime+darkTemp from  
    Header  
      


### set.Flat

setter for Flat property - set FlatFilter from Header


    
    setter for Flat property - set FlatFilter from Header  
      


### set.Fringe

setter for Fringe property - set FringeExpTime+FringeFilter from Header


    
    setter for Fringe property - set FringeExpTime+FringeFilter from  
    Header  
      


### unitTest

unitTest for CalibImages class


    
    unitTest for CalibImages class  
      
      


