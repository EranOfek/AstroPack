;#autogen:ignore

# Overview

The Tran2D class is a container for 2D spatial transformation (e.g., transformation used for astrometry or image registration). Tran2D supports only transformations which are linear in their coeficents. E.g.,

	Xi = c1*FunX{1}(x,y,add_par) + c2*Fun{2}(...) + ...
	Yi = ...
	
where FunX are user defined functionalls, x,y are the coordinates after 
applying a normalization transformation stored in FunNX and FunNY with parameters 
in ParNX and ParNY, respectively. add_par are additional parameters like color, 
airmass, and parallactic angle.

ColCell - A cell array of variable names on which the transformation depends. Usually, the first two are 'x' and 'y'. The other may be variables like color and airmass. These variables represents the arguments of the FunX and FunY functionals.
FunX - A cell array of function_handles (called functionals). The functionals represents the linear transformation of the form: Xi = c1*FunX{1}(x,y,add_par) + c2*Fun{2}(...) + ...
FunY - Like FunX, but for the Y axis.
FunNX - A function handle that represent the normalization transformation on the X-axis, prior to the FunX transformation. Default is @(x,nx1,nx2) (x-nx1)./nx2;
FunNY - Like FunNX, but for the Y axis.
ParX - A vector of arguments of the FunX transformation coeficients.
ParY - Like ParX, but for the Y axis.
ParNX - A vector of coeficients for the X-axis normalization transformation.
ParNY - Like ParNX, but for the Y axis.
FitData - Addition data regarding the quality of the fit.
PolyRep - A structure containing the polynomial representation of the transformation.
Constructor
The Tran2D constructor can be used to generate default transformation objects. A few examples:
% Construct a Tran2D object with the default 'cheby1_3_c1' functionals:
TC=Tran2D
% for example, TC.FunX contains the X-axis functionals.
% The first functional contains a function that returns a ones - e.g.,
% representing an additive constant.
TC.FunX{1}
% The second functional contains a function that returns x - e.g., a linear
% function in x.
TC.FunX{2}

% To generate two transformation objects
TC=Tran2D(2)
% To generate two transformation objects with different transformations
TC=Tran2D('cheby1_3_c1','cheby1_2');

% For the list of built in transformations - see:
help Tran2D.selected_trans
Setters and getters

Static methods
isTran2D - Return true if a Tran2D object. selected_trans - Return predefined 2D transformations.
functionals2symPoly - Construct a symbolic polynomials from functionals
functionals2polyCoef - Given functionals and their polynomial representation generated by Tran2D.functionals2symPoly, collect the polynomial coeffocients and calculate their values.
unitTest - unit Test for the class.
Examples
% test the class
Tran2D.unitTest
Methods
Set and use the transformations
design_matrix - construct design matrices for a position.
nfuns - count number of free linear parameters in FunX and FunY.
isParKnown - Check if number of parameters is consistent with number of functionals.
forward - Applay forward transformation to coordinates.
backward - Applay backward transformation to coordinates.
fit_simple - A simple fit (no errors/iterations) of a data to the transformation
Examples


T=Tran2D;
% Construct a design matrix, H, for the transformation
% such that x = Hx*Par
Coo = rand(10,2);
[Hx,Hy]=design_matrix(T,Coo)
     
% populate the coef.
TC=Tran2D; TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13); 
TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;
TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;
% forward and backward transformations
[Xf,Yf]=forward(TC,[1 1.3;2 6;3 3]);
[X,Y]=backward(TC,Xf, Yf);

Generate a polynomial representation of the transformations
functionals2symPoly - (Static) Construct a symbolic polynomials from functionals.
functionals2polyCoef - (Static) Convert functionals and parameters to polynomial coefficients
symPoly - Construct a symbolic polynomials from a Tran2D object.
polyCoef - Convert a Tran2D object and parameters to polynomial coefficients.
symPoly2deg - Return the X and Y poly deg vectors of the polynomial representations.
polyRep - Update the PolyRep polynomial representation property
Examples


% Symbolic representations of polynomials:
% E.g., converting Chebyshev functionals to regular polynomials.
% The functionals2symPoly static function returns the symbolic
% representation of the original functionals.
% CX,CY is an array of symbolic functions of the coeficienst of the
% polynomial functionals.
% PX, PY are the polynomials functionals.
TC=Tran2D;
[CX,CY,PX,PY] = Tran2D.functionals2symPoly(TC.ColCell,TC.FunX,TC.FunY,TC.FunNX,TC.FunNY);
% for example:
PX(1) % contains the first symbolic polynomial functional
% and 
CX(1) % contains the first symbolic coef, corresponding to the first symbolic polynomial.

% symPoly is a method of Tran2D that populate the PolyRep with
% the CX, CY, PX, PY symbolic functions.
% This function is slow and should be run once the Tran2D was constructed.
[CX,CY,PX,PY]=symPoly(TC);
% Next populate the ParX, ParY:
TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13); 
TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;
TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;
% Calculate the numerical value of the polynomials coef.
% The coef. are populated in: TC.PolyRep.PolyParX, PolyParY:
[PolyCoefX, PolyCoefY, PX, PY] = TC.polyCoef
% Return the X and Y poly deg vectors of the polynomial representations
% and populate them in PolyRep:
[PolyX_Xdeg,PolyX_Ydeg,PolyY_Xdeg,PolyY_Ydeg]=symPoly2deg(TC)

% Update/repopulate the PolyRep polynomial representation property
TC = Tran2D;
TC.ParY=zeros(1,13);  TC.ParX=zeros(1,13); 
TC.ParX(1:2) = 1; TC.ParX(5)=0.03; TC.ParX(7)=0.01;
TC.ParY(1) = 2; TC.ParY(3)=1.01; TC.ParY(5)=0.01; TC.ParY(8)=0.001;
TC=polyRep(TC, true)
How to use the polynomial representation?
After populating ParX and ParY and running the polyRep method the PolyRep property is populated. The PolyParX and PolyParY containing the numerical values of the coef. of the polynomials.
PolyX_Xdeg and PolyX_Ydeg are the polynomials degree of X and Y, respectively, for the X polynomial, and so on.
